---
title: Revisiting two charts of the Statistical Atlas 1874
author:
  - name: Heike Hofmann
    email: hofmann@mail.iastate.edu
    affiliation: Iowa1
    footnote: Corresponding Author
  - name: Ryan Goluch
    email: rgoluch@mail.iastate.edu
    affiliation: Iowa2
address:
  - code: Iowa1
    address: Department of Statistics and Statistical Laboratory, Iowa State University, Ames, IA 50011-1121
  - code: Iowa2
    address: Department, Iowa State University, Ames, IA 50011-1121
abstract: |
  This is the abstract.

  It consists of two paragraphs.

bibliography: mybibfile.bib
output: rticles::elsevier_article
---

Introduction
===

Three times in the past, the US Census Bureau published a Statistical Atlas to map the state of the Union based on data collected in the 9th, 10th, and 11th US census (in 1870, 1880, and 1890). Each of these atlases represents a  masterpiece in science and technology. Here, we want to focus on the ninth Census, supervised by Francis A. Walker. At this time, the United States had a population of about 38.5 million people. The Atlas represents a graphical compendium of the census information prepared in more than 100 lithographic plates. Most of these plates are overlaid maps, but some consist of more abstract and, at that time, novel visualizations.
Of particular interest are plates #31 and #32. Both of these plates have a very similar studture: they show small multiples, one for each state, of what are now known as mosaic plots or  Marimekko charts.


At the time the Statistical Atlas for the ninth census was created, Mosaic plots were a novel way of visualizing data. Even though sometimes Minard [@minard44] is cited as the first to create a mosaic plot [@friendly], the square form of a  Mosaic plot wasn't published until 1877 [@mayr].

were not a well established form of visualizing data 

XXX What we are planning on doing here

1. *Discuss the charts:* 
2. *Recreate the charts:* that involves to get the data, check that it is the right data and re-create the charts (to the degree that modern charts will allow us to do that). In order to be able to check the data for correctness, we have to digitize the information provided in the chart (by measuring the relevant geometric objects).
3. *Re-display the data:* some of the visualization choices made in the original charts are cognitively questionable. Re-displaying the data also allows us to introduce a spatial component.

Plate #32: Gender Ratio in Agriculture, Trade, Service, Manufacturing, and Schools
===

Figure \ref{fig:occupation} shows a miniature of the chart published as plate #32 in the Statistical Atlas of 1874 [@atlas] produced from data collected in the 9th US Census. 
The chart is set-up in form of small multiples [@tufte], also known as lattice or trellis plots [@becker:1996], one for each state and an enlarged plot as with an overview of the nation-wide aggregates. States are represented by squares of the same size, representing "the total population over 10 years of age", as detailed in the zoom-in in Figure \ref{fig:header}, which shows the description at the top of the plate. 

![Plate #32 from the Statistical Atlas of 1874: Gender ratio of population over the age of 10 in different types of occupation. \label{fig:occupation}](images/ca000082.jpg)

With the help of the description and the legend of Figures \ref{fig:header} and \ref{fig:legend}, we can interpret the details of each of the squares at the example of  Figure \ref{fig:us}. This figure shows an overview of type of occupation by gender across the US in 1870. It is essentially a mosaic [@hartigan:1981, @friendly] or Marimekko plot [citation?] of type of occupation (horizontal) and gender (vertical), but with a twist: the grey band around each one of the states' squares is proportional to the number of population "unaccounted" for, i.e. the difference between the total population over the age of ten and the population gainfully employed in one of the five categories or attending school. The choice to show this part of the population by a band around is somewhat unfortunate, as it breaks the overall metaphor of the mosaicplot and thereby prevents any direct comparisons across charts except for area comparisons, which are cognitively harder and more error prone than comparisons of lengths [@cleveland:1984]. It also masks the size of the population that is thus *unaccounted* for by visually cutting it into a quarter of the size it actually is. The percentage of unaccounted individuals is at about 30% nation-wide higher than any of the other groups. It is also made up of about 97% women and girls.

![Zoom-in to the description section of plate #32 \label{fig:header}](images/header.png)


![Zoom-in to the legend section of plate #32 \label{fig:legend}](images/legend.png)

![Zoom-in to the overview of the US wide distribution of genders across occupations. \label{fig:us}](images/occupations-us.png)

The Data
===

The data used to recreate the visualization of plate #32 is retrieved from @NHGIS, in particular, from table NT13 on "Employed Population by Occupation by Age by Sex". These numbers are state-level aggregates of population numbers by occupation, gender, and sex. We aggregate across ages to get the values included here.
Because state-level aggregates of the number of total population above the age of ten is not available, we are making use of the 1\% microsample of the ninth census provided by the Integrated Public Use Microdata Series (IPUMS-USA) provided through the Minnesota Population Center [@ipums]. This allows us to get state-wide estimates for the size of the male and female population above ten for each state by scaling up from the 1\% sample. Based on these estimates we derive the size of the population not "gainfully employed" or attending school. 
Figure \ref{fig:comparison} shows that the numbers combined from NT13 and the microsample closely match the information on plate #32. For all occupation levels and school attendance the numbers are *very* close. For population not accounted for, the numbers are estimated from the 1% ipums microsample. this inflates the variability in these numbers, but the relationship to the visual measurements is still very strong. 

Big picture goals
===

- **reproducibility**: can we re-produce results, i.e. images, of the Statistical Atlas based on the resources we have access to today?
The resources are: ipums, NHGIS, the high resolution images of the digitized version of the Statistical Atlas provided by the National Library of Congress. 

```{r echo = FALSE, message = FALSE}
library(tidyverse)
occupation <- read.csv("../Data/occupation.csv")
occupation$State <- as.character(occupation$Area.name)
occupation$Territory <- as.logical(gsub(".* Territory", "TRUE", occupation$State))
occupation$Area.name <- gsub(" Territory", "", occupation$Area.name)
occupation$Area.name <- gsub(" Department", "", occupation$Area.name)
occupation$Area.name <- gsub(" Terr.", "", occupation$Area.name)


occ2 <- occupation %>% gather(key="Occupation.Gender", value="Number", 2:11, factor_key = TRUE)
occ2 <- occ2 %>% select(State, Total.Population, Occupation.Gender, Number) %>% 
  separate(Occupation.Gender, into=c("Occupation", "Gender"))
occ2 <- occ2 %>% mutate(
  Occupation = factor(Occupation, levels= c("Agriculture", "Manufacturing",
                                            "Trade", "Service", "School")),
  Gender = factor(Gender, levels=c("Male", "Female"))
)
occ2 <- occ2 %>% group_by(State) %>% mutate(Total.Employed=sum(Number))
occ2$Area.Name <- gsub(" Territory","", occ2$State)
occ2$Area.Name <- gsub(" Terr.","", occ2$Area.Name)
```

```{r fig.width=5, fig.height=5.5, echo = FALSE, message=FALSE, fig.pos="center",fig.cap="Recreation of the mosaicplot based on gainfully employed population over ten."}
cols <- c("#333300", "#000066", "#cc9900", "#202060", "#86742d")
library(ggmosaic)
occ2 %>% filter(State==Area.Name) %>% ggplot() +
  geom_mosaic(aes(x = product(Gender, Occupation), 
                  fill=Occupation, alpha = Gender, weight = Number),
              offset = 0.005) + 
  scale_fill_manual(values=cols) + theme_bw() +
  scale_alpha_manual(values=c(0.8,1)) +
  theme(legend.position = "top") + 
  coord_equal() +
    theme(axis.line=element_blank(), axis.text=element_blank(), 
        axis.title.y = element_blank(), axis.ticks = element_blank()) +
  xlab("The United States")
```


```{r fig.width=10, fig.height=12, echo = FALSE, message=FALSE, fig.pos="center", fig.cap="Recreation of mosaics of gainful occupation by states."}
occ2 %>% filter(Area.Name==State) %>% ggplot() +
  geom_mosaic(aes(x = product(Gender, Occupation), 
                  fill=Occupation, alpha = Gender, weight = Number),
              offset = 0.005) + 
  scale_fill_manual(values=cols) + theme_bw() +
  scale_alpha_manual(values=c(0.8,1)) +
  theme(legend.position = "top") + 
  facet_wrap(~State, ncol=6) +
#  coord_equal() +
  theme(axis.line=element_blank(), axis.text=element_blank(), 
        axis.title = element_blank(), axis.ticks = element_blank(),
        aspect.ratio=1) 
```


```{r fig.width=10, fig.height=12, echo = FALSE, message=FALSE, fig.pos="center",fig.cap="Mosaics of gainful occupation by territories."}
occ2 %>% filter(Area.Name != State) %>% ggplot() +
  geom_mosaic(aes(x = product(Gender, Occupation), 
                  fill=Occupation, alpha = Gender, weight = Number),
              offset = 0.005) + 
  scale_fill_manual(values=cols) + theme_bw() +
  scale_alpha_manual(values=c(0.8,1)) +
  theme(legend.position = "top") + 
  facet_wrap(~State, ncol=6) +
#  coord_equal() +
  theme(axis.line=element_blank(), axis.text=element_blank(), 
        axis.title = element_blank(), axis.ticks = element_blank(),
        aspect.ratio=1) 
```

Maps
===

The R package `USAboundaries` [@USAboundaries] provides historical US state borders. This is used to map the US in 1870 in Figure \ref{fig:us1870}.

```{r echo = FALSE, message = FALSE, fig.pos="center", fig.cap="Map of States in the US in 1870 \\label{fig:us1870}"}
library(USAboundaries)
map_states <- us_boundaries("1870-01-01", type = "state")
map1870 <- map_data(map_states)
map1870$Territory <- gsub(".* Territory", "TRUE", map1870$region)
map1870$Territory <- gsub(".* Department", "TRUE", map1870$Territory)
map1870$Territory <- as.logical(gsub(".* Terr.", "TRUE", map1870$Territory))
map1870$Parts <- c("Territory", "State")[is.na(map1870$Territory)+1]
map1870 %>% filter(lat <= 50) %>% 
  ggplot(aes(x = long, y = lat, group = group, fill=Parts)) +
  geom_polygon() + scale_fill_manual(values=c("grey50", "grey70")) + 
  ggthemes::theme_map()
```


```{r, message=FALSE, fig.height = 8, fig.width=5, echo=FALSE, fig.pos="center", fig.cap="Density plots: each dot represents (according to its size) the number of people employed in each occupation or going to school. For women in particular, strong geographic patterns emerge.\\label{fig:density}", cache=TRUE}

popmap <- left_join(map1870, occ2, by=c("region"="State")) %>% filter(lat <= 50)

library(ggmapr)
popmap$jitters1 <- round(popmap$Number/100000,0)
popmap$jitters2 <- round((popmap$Number %% 100000)/10000,0)
popmap$jitters3 <- round((popmap$Number %% 10000)/1000,0)
popmap %>% filter(!is.na(Number)) %>% ggplot(aes(x = long, y = lat)) +
   geom_polygon(aes(group = group, fill=Parts), colour="white", size = 0.5) +
   stat_polygon_jitter(aes(long = long, lat = lat, group = Area.Name, 
                           mapgroup = group, n = jitters1, 
                           colour = Occupation, size="a")) +
   stat_polygon_jitter(aes(long = long, lat = lat, group = Area.Name, 
                           mapgroup = group, n = jitters2, 
                           colour = Occupation, size="b")) +
   stat_polygon_jitter(aes(long = long, lat = lat, group = Area.Name, 
                           mapgroup = group, n = jitters3, 
                           colour = Occupation, size = "c")) +
   ggthemes::theme_map() + facet_grid(Occupation~Gender) +
  scale_colour_brewer(palette="Dark2", guide="none") +
  scale_fill_manual(values=c("grey80", "grey95")) +
  theme(legend.position="top") +
  scale_size_manual("Population:", labels=c("100,000","10,000", "1,000"), values=c(1,.5,.25))
```

```{r echo = FALSE, eval = FALSE}
ipums <- read.csv("../Data/ipums-1870.csv")
ages <- ipums %>% group_by(STATEICP) %>% summarize(total = n(), above10 = sum(AGE>10))
ages.sex <- ipums %>% group_by(STATEICP, SEX) %>% summarize(total = n(), above10 = sum(AGE>10))
write.csv(ages, file="../Data/ages-ipums.csv", row.names=FALSE)
write.csv(ages.sex, file="../Data/ages-sex-ipums.csv", row.names=FALSE)
```

```{r echo = FALSE, fig.pos="center", fig.cap="Mosaic plot of the US-wide gender ratio of population over ten years of age in different occupations, school, and others."}
ages <- read.csv("../Data/ages-ipums.csv")
ages <- ages %>% mutate(
  STATEICP = replace(STATEICP, STATEICP == "Louisianna", "Louisiana"),
  STATEICP = replace(as.character(STATEICP), STATEICP %in% c("South Dakota", "North Dakota"), "Dakota")
)
ages <- ages %>% group_by(STATEICP) %>% summarize(total=sum(total), above10 = sum(above10))

ages.sex <- read.csv("../Data/ages-sex-ipums.csv")
ages.sex <- ages.sex %>% mutate(
  STATEICP = replace(STATEICP, STATEICP == "Louisianna", "Louisiana"),
  STATEICP = replace(as.character(STATEICP), STATEICP %in% c("South Dakota", "North Dakota"), "Dakota")
) %>% group_by(STATEICP, SEX) %>% summarize(above10=sum(above10))
ages.sex <- ages.sex %>% 
  spread(key=SEX, value=above10)
names(ages.sex)[2:3] <- c("above10.Female", "above10.Male")

# all good!
# anti_join(occupation, ages, by=c("Area.name"="STATEICP")) %>% count(State)
occupation2 <- left_join(occupation, ages, by=c("Area.name"="STATEICP")) 
occupation2$Total.Above10.Est <- with(occupation2, above10/total*Total.Population)
occupation3 <- left_join(occupation2, ages.sex, by=c("Area.name"="STATEICP"))
occupation3 <- occupation3 %>% mutate(
  Total.Above10.Female = above10.Female/above10*Total.Above10.Est,
  Total.Above10.Male = above10.Male/above10*Total.Above10.Est,
  Employed.Female = Agriculture.Female+Manufacturing.Female+Trade.Female+Service.Female+School.Female,
  Employed.Male = Agriculture.Male+Manufacturing.Male+Trade.Male+Service.Male+School.Male,
  Unaccounted.Female = Total.Above10.Female - Employed.Female,
  Unaccounted.Male = pmax(Total.Above10.Male - Employed.Male,0)
)

occ3 <- occupation3 %>% gather(key="Occupation.Sex", value="Number", c(2:11,24:25)) %>% separate(Occupation.Sex, into=c("Occupation", "Sex"))
occ3 <- occ3 %>% mutate(
  Occupation = factor(Occupation, levels= c("Agriculture", "Manufacturing",
                                            "Trade", "Service", "School", "Unaccounted")),
  Sex = factor(Sex, levels=c("Male", "Female"))
)
```


```{r echo=FALSE, fig.pos="center", warning = FALSE, fig.cap="Set of scatterplots showing a comparison of estimates of occupation percentages based on the Census Data (y) and Chart measurements (x). \\label{fig:comparison}"}
pixels2 <- read.csv("../Data/pixel-values.csv")
pixels2$Unaccounted <- (451^2 - (451-2*pixels2$Unaccounted)^2)/451

px1 <- pixels2 %>% select(State, Agriculture, Manufacturing, Trade, Service, School, Unaccounted) %>% gather(key="Occupation", value="Pixels", -State, factor_key=TRUE)
px1 <- px1 %>% group_by(State) %>% mutate(State.Pixels=sum(Pixels))
px1 <- px1 %>% mutate(PixPercent = Pixels/State.Pixels*100) %>% arrange(State)

occ4 <- occ3 %>% select(Area.name, Occupation, Sex, Number) %>% 
  spread(key="Sex", value="Number") %>%
  mutate(Number = Male + Female) %>% 
  group_by(Area.name) %>%
  mutate(Total = sum(Number), 
         CensusPercent = Number/Total*100) %>%
  select(-Male, -Female, -Total)

px2 <- full_join(px1, occ4, by=c("State"="Area.name", "Occupation")) 

px2 %>% 
  ggplot(aes(x = PixPercent, y = CensusPercent)) +
  geom_abline() + geom_point() + 
  facet_wrap(~Occupation) + theme_bw() +
  xlab("Percentages of occupation based on Plate #32") +
  ylab("Percentages based on Census Data")
```

```{r echo = FALSE, fig.pos="center", fig.cap="Mosaicplot of the gender ratio in different occupations of the population ten years of age and above."}
cols <- c("#333300", "#000066", "#cc9900", "#202060", "#86742d", "grey40")
occ3 %>% filter(Area.name==State) %>% ggplot() +
  geom_mosaic(aes(x = product(Sex, Occupation), 
                  fill=Occupation, alpha = Sex, weight = Number),
              offset = 0.005) + 
  scale_fill_manual(values=cols) + theme_bw() +
  scale_alpha_manual(values=c(0.8,1)) +
  theme(legend.position = "top") + 
  coord_equal() +
    theme(axis.line=element_blank(), axis.text=element_blank(), 
        axis.title.y = element_blank(), axis.ticks = element_blank()) +
  xlab("The United States")
```

```{r fig.width=10, fig.height=12, echo = FALSE, message=FALSE, fig.pos="center",fig.cap="Mosaics of gainful occupation by territories including population not employed."}
occ3 %>% filter(Area.name==State) %>% ggplot() +
  geom_mosaic(aes(x = product(Sex, Occupation), 
                  fill=Occupation, alpha = Sex, weight = Number),
              offset = 0.005) + 
  scale_fill_manual(values=cols) + theme_bw() +
  scale_alpha_manual(values=c(0.8,1)) +
  theme(legend.position = "top") + 
  facet_wrap(~State, ncol=6) +
  coord_equal() +
    theme(axis.line=element_blank(), axis.text=element_blank(), 
        axis.title = element_blank(), axis.ticks = element_blank()) 
```


References {#references .unnumbered}
==========
